<!DOCTYPE html>
<html lang="zh-TW" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="x-apple-disable-message-reformatting" />
    <title>Business Card Scanner</title>

    <!-- SheetJS CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Material Design Icons -->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />

    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/style.css" />

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-7ECCXXKS0C"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-7ECCXXKS0C");
    </script>
  </head>
  <body>

    <div id="initDialog" class="init-dialog" style="display: none;">
    <div class="init-dialog-overlay"></div>
    <div class="init-dialog-content">     

      <div class="init-dialog-body">
        <div class="form-group">
          <select id="officeSelect" class="form-control" required>
            <option value="initOptionSelect">-- Select Your Office --</option>
            <option value="USA"> USA Team</option>
            <option value="GM"> DE Team</option>
            <option value="NL"> NL Team</option>
            <option value="UK"> UK Team</option>
            <option value="JP"> JP Team</option>
            <option value="KR"> KR Team</option>
            <option value="TW"> TW Team</option>
            <option value="CN"> CN Team</option>
            <option value="HK"> HK Team</option>
          </select>
        </div>
        <div class="form-group">
          <input  
            type="text" 
            id="userNameInput" 
            class="form-control" 
            placeholder="Enter Your Name (2-32 characters)"
            minlength="2"
            maxlength="32"
            autocomplete="off"
            required
          >
          <div id="nameError" class="error-message" style="display: none;"></div>
        </div>        
      </div>

      <div class="init-dialog-footer">
        <button id="saveUserInfoBtn" class="btn btn-primary btn-large" onclick="saveUserInfo()">
          <i class="material-icons">save</i>
          Save >
        </button>
      </div>      
    </div>
  </div>

    <div class="container">
      <!-- Header -->
      <div class="header">
        <img
          src="https://www.transcend-info.com/images/ts_logo.png"
          alt="TranscendLogo"
        />
        <h1 id="headerTitle">Business Card Scanner</h1>
      </div>

      <!-- Content -->
      <div class="content">
        <!-- Alert Messages -->
        <div id="alertSuccess" class="alert alert-success"></div>
        <div id="alertError" class="alert alert-error"></div>
        <div id="loadingDiv" class="loading">
          <p id="loadingText">
            <i class="material-icons">document_scanner</i> Scanning business
            card, please wait...
          </p>
          <p id="progressText" style="margin-top: 5px; font-size: 12px">
            Loading...
          </p>
        </div>

        <!-- Preview Box -->
        <div
          class="preview-box"
          id="previewBox"
          onclick="triggerFileInput(event)"
        >
          <div class="preview-placeholder">
            <i class="material-icons">add_a_photo</i>
            <p id="previewText">Click to upload a business card</p>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="button-group">
          <button class="btn btn-primary" onclick="openCamera()">
            <span id="btnCamera"
              ><i class="material-icons">photo_camera</i> Camera</span
            >
          </button>
        </div>

        <input
          type="file"
          id="fileInput"
          accept="image/*"
          onchange="handleFileSelect(event)"
        />
        <input
          type="file"
          id="cameraInput"
          accept="image/*"
          capture="environment"
          onchange="handleFileSelect(event)"
        />

        <!-- Form Section -->
        <div class="form-section">
          <div class="form-title" id="formTitle">
            <i class="material-icons">assignment</i> Scan Results
          </div>

          <div class="form-group">
            <label class="form-label" id="labelName"
              ><i class="material-icons">person</i> Name</label
            >
            <input type="text" class="form-input" id="nameInput" />
          </div>

          <div class="form-group">
            <label class="form-label" id="labelJobTitle"
              ><i class="material-icons">work</i> Job Title</label
            >
            <input type="text" class="form-input" id="jobTitleInput" />
          </div>

          <div class="form-group">
            <label class="form-label" id="labelDepartment"
              ><i class="material-icons">domain</i> Department</label
            >
            <input type="text" class="form-input" id="departmentInput" />
          </div>

          <div class="form-group">
            <label class="form-label" id="labelPhone"
              ><i class="material-icons">phone</i> Tel</label
            >
            <input type="text" class="form-input" id="phoneInput" />
          </div>

          <div class="form-group">
            <label class="form-label" id="labelMobile"
              ><i class="material-icons">smartphone</i> Mobile</label
            >
            <input type="text" class="form-input" id="mobileInput" />
          </div>

          <div class="form-group">
            <label class="form-label" id="labelFax"
              ><i class="material-icons">print</i> Fax</label
            >
            <input type="text" class="form-input" id="faxInput" />
          </div>

          <div class="form-group">
            <label class="form-label" id="labelEmail"
              ><i class="material-icons">email</i> Email</label
            >
            <input type="email" class="form-input" id="emailInput" />
          </div>

          <div class="form-group">
            <label class="form-label" id="labelCompany"
              ><i class="material-icons">apartment</i> Company Name</label
            >
            <input type="text" class="form-input" id="companyInput" />
          </div>

          <div class="form-group">
            <label class="form-label" id="labelAddress"
              ><i class="material-icons">place</i> Company Address</label
            >
            <input type="text" class="form-input" id="addressInput" />
          </div>

          <div class="form-group">
            <label class="form-label" id="labelWebsite"
              ><i class="material-icons">language</i> Company Website</label
            >
            <input type="url" class="form-input" id="websiteInput" />
          </div>

          <!-- ADDED NOTE FIELD HERE -->
          <div class="form-group">
            <label class="form-label" id="labelNote"
              ><i class="material-icons">note</i> Note</label
            >
            <textarea class="form-input" id="noteInput" rows="2"></textarea>
          </div>

          <div class="form-group" id="taxIdField" style="display: none">
            <label class="form-label" id="labelTaxId"
              ><i class="material-icons">confirmation_number</i> Áµ±‰∏ÄÁ∑®Ëôü
            </label>
            <input type="text" class="form-input" id="taxIdInput" />
          </div>

          <!-- Action Buttons -->
          <button
            class="btn btn-primary btn-xl"
            onclick="saveCard()"
            style="margin-bottom: 30px"
          >
            <span id="btnSave"><i class="material-icons">save</i> Save</span>
          </button>

          <button
            class="btn btn-success btn-large"
            onclick="exportHistoryToExcel()"
            style="margin-bottom: 30px; display: none"
          >
            <span id="btnExport"
              ><i class="material-icons">file_download</i> Export All</span
            >
          </button>

          <button
            class="btn btn-primary btn-large"
            onclick="syncHistoryToCloud()"
            style="margin-bottom: 30px"
          >
            <span id="btnSync"
              ><i class="material-icons">cloud_upload</i> Sync to Cloud</span
            >
          </button>

          <button
            class="btn btn-success btn-large"
            onclick="downloadFirebaseExcel()"
            style="margin-bottom: 30px; display: none"
          >
            <span id="btnExport"
              ><i class="material-icons">cloud_download</i> Download Excel </span
            >
          </button>
        </div>

        <!-- üîµ ÂúìÂΩ¢ Admin Icon - Âè≥‰∏ãËßíÂõ∫ÂÆö -->
<div class="admin-icon-wrapper">
  <div class="admin-icon" onclick="openAdminPopup()" title="Admin Login">
    <i class="material-icons">manage_accounts</i>
  </div>
</div>

<!-- Admin Login Pop-up -->
<div id="adminPopup" class="popup-overlay">
  <div class="popup-box">
    <div class="popup-header">
      <div class="popup-header-left">
        <i class="material-icons">manage_accounts</i>
        <h3>Admin Login</h3>
      </div>
      <button class="close-btn" onclick="closeAdminPopup()">
        <i class="material-icons">close</i>
      </button>
    </div>
    
    <div class="popup-body">
      <div class="form-group">
        <select id="adminNameSelect" class="admin-form-select">
          <option value="">Please select ... </option>
          <option value="terri">USA Terri</option>
          <option value="mike">USA Mike</option>
          <option value="andy">USA Andy</option>
          <option value="andy">TW RD4-Admin</option>
        </select>
      </div>

      <div class="form-group">
        <input 
          type="text" 
          id="adminEmployeeInput" 
          class="admin-form-input" 
          placeholder="Please enter your TSID ex.LA0123"
          maxlength="6"
          autocomplete="off"
        />
      </div>

      <div id="adminErrorMsg" class="admin-error-message">
        <i class="material-icons">error</i>
        <span id="adminErrorText"></span>
      </div>

      <div id="adminSuccessMsg" class="admin-success-message">
        <i class="material-icons">check_circle</i>
        <span> Login Success ‚úì</span>
      </div>
    </div>
    
    <div class="popup-footer">
      <button id="adminVerifyBtn" class="btn-admin-verify" onclick="verifyAdmin()">
        <i class="material-icons">login</i>
        <span>Login </span>
      </button>
    </div>
  </div>
</div>

<script>
function openAdminPopup() {
  const popup = document.getElementById('adminPopup');
  if (popup) {
    popup.classList.add('show');
    setTimeout(() => {
      const nameSelect = document.getElementById('adminNameSelect');
      if (nameSelect) nameSelect.focus();
    }, 300);
  }
}

function closeAdminPopup() {
  const popup = document.getElementById('adminPopup');
  if (popup) {
    popup.classList.remove('show');
  }
}

function verifyAdmin() {
  alert('Ongoing...');
}

// ÈªûÊìäÈÅÆÁΩ©ÈóúÈñâ
document.addEventListener('DOMContentLoaded', function() {
  const popup = document.getElementById('adminPopup');
  if (popup) {
    popup.addEventListener('click', function(e) {
      if (e.target === this) {
        closeAdminPopup();
      }
    });
  }
});
</script>


        <!-- Language Selector -->
        <div class="language-selector">
          <select id="languageSelect" onchange="changeLanguage()">
            <option value="en">English</option>
            <option value="de">Deutsch</option>
            <option value="nl">Nederlands</option>
            <option value="jp">Êó•Êú¨Ë™û</option>
            <option value="kr">ÌïúÍµ≠Ïñ¥</option>
            <option value="sc">ÁÆÄ‰Ωì‰∏≠Êñá</option>
            <option value="tc">ÁπÅÈ´î‰∏≠Êñá</option>
          </select>
        </div>
      </div>

      <!-- Footer -->
      <div class="footer">
        <p>Copyright ¬© Transcend Information, Inc. All Rights Reserved.</p>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js"></script>

    <script src="js/translations.js"></script>
    <script src="js/ocrKeywords.js"></script>
    <script src="js/initDialog.js"></script>
    <script src="js/app.js"></script>  
    <script src="js/syncCloud.js"></script>   
    <script src="js/firebaseExport.js"></script>

  <!-- Firebase SDK (v10 - Modular)  -->
  <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";
  import { 
    getFirestore,
    collection,
    addDoc,
    getDocs,
    getDoc,
    setDoc, 
    doc,
    query,
    where,
    orderBy,
    limit,
    serverTimestamp,
    Timestamp
  } from 'https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js';
  import { 
    getStorage,
    ref as storageRef,
    uploadString,
    getDownloadURL
  } from 'https://www.gstatic.com/firebasejs/12.8.0/firebase-storage.js';

  // Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyD2E-FnZGs5Jc2eghw9T_815FLeoHxAcIc",
    authDomain: "gen-lang-client-0513493885.firebaseapp.com",
    projectId: "gen-lang-client-0513493885",
    storageBucket: "gen-lang-client-0513493885.firebasestorage.app",
    messagingSenderId: "657748626710",
    appId: "1:657748626710:web:81bf41ea24574a9ba89437",
    //measurementId: "G-9L8X6K5T4X"
  };
  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  window.firebaseApp = app;
  window.firebaseDB = db;
  window.firebaseStorage = storage;
  window.firebaseModules = {
      collection, doc, getDocs, getDoc, addDoc,
      query, where, orderBy, limit,
      serverTimestamp, Timestamp,
      storageRef, uploadString, getDownloadURL
    };
    
  console.log('Firebase ready');  
</script>
  </body>
</html>
